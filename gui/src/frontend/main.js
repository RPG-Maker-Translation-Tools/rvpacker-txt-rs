const{ipcRenderer:ipcRenderer}=require("electron"),{constants:constants,readFileSync:readFileSync,readdirSync:readdirSync,ensureDirSync:ensureDirSync,copyFileSync:copyFileSync,accessSync:accessSync,writeFileSync:writeFileSync,pathExistsSync:pathExistsSync}=require("fs-extra"),{fork:fork}=require("child_process"),{join:join}=require("path"),PRODUCTION=!1;function render(){const e=join(__dirname,"../../../copies"),t=join(__dirname,"../../../backups"),n=join(__dirname,"../../../translation");!function(){try{return void accessSync(n,constants.F_OK)}catch{alert("Не удалось найти файлы перевода. Убедитесь, что вы включили папку translation в корневую директорию программы."),ipcRenderer.send("quit")}try{return accessSync(join(n,"maps"),constants.F_OK),accessSync(join(n,"other"),constants.F_OK),void accessSync(join(n,"plugins"),constants.F_OK)}catch{alert("Программа не может обнаружить папки с файлами перевода внутри папки translation. Убедитесь, что в папке translation присутствуют подпапки maps и other."),ipcRenderer.send("quit")}}(),function(){if(function(){ensureDirSync(e),ensureDirSync(join(e,"maps")),ensureDirSync(join(e,"other")),ensureDirSync(join(e,"plugins"));const t=readdirSync(join(n,"maps")).length,i=readdirSync(join(n,"other")).length,s=readdirSync(join(n,"plugins")).length,r=readdirSync(join(e,"maps")).length,a=readdirSync(join(e,"other")).length,o=readdirSync(join(e,"plugins")).length;return r===t&&a===i&&o===s}())return;for(const t of readdirSync(join(n,"maps")))copyFileSync(join(n,"maps",t),join(e,"maps",t));for(const t of readdirSync(join(n,"other")))copyFileSync(join(n,"other",t),join(e,"other",t));for(const t of readdirSync(join(n,"plugins")))copyFileSync(join(n,"plugins",t),join(e,"plugins",t))}();const i=document.getElementById("content-container"),s=document.getElementById("search-input"),r=document.getElementById("replace-input"),a=document.getElementById("left-panel"),o=document.getElementById("search-results"),l=document.getElementById("search-content"),c=document.getElementById("replace-content"),d=document.getElementById("save-button"),m=document.getElementById("compile-button"),u=document.getElementById("case-button"),g=document.getElementById("whole-button"),p=document.getElementById("regex-button"),f=document.getElementById("translate-button"),h=document.getElementById("location-button"),v=document.getElementById("backup-check"),y=document.getElementById("backup-settings"),E=document.getElementById("backup-period-input"),x=document.getElementById("backup-max-input"),b=document.getElementById("goto-row-input"),L=new Map;let k,S,w;!function e(){try{const e=JSON.parse(readFileSync(join(__dirname,"settings.json"),"utf8"));return k=e.backup.enabled,S=e.backup.period,void(w=e.backup.max)}catch(t){alert("Не удалось получить настройки."),ipcRenderer.invoke("create-settings-file").then((t=>{t&&e()}))}}();let j=!1,I=!1,_=!1,C=!1,$=!1,A=!1,T="main",B="main",F=!0;v.innerHTML=k?"check":"close",y.classList.toggle("hidden",!k),E.value=S,x.value=w,pathExistsSync(join(__dirname,"replacement-log.json"))||writeFileSync(join(__dirname,"replacement-log.json"),"{}","utf8"),ensureDirSync(t);let M=parseInt(function(){const e=readdirSync(t);return 0===e.length?"00":e.map((e=>e.slice(-2))).sort(((e,t)=>t-e))[0]}())+1;k&&J(S),function(){const t={originalMapText:"maps/maps.txt",translatedMapText:"maps/maps_trans.txt",originalMapNames:"maps/names.txt",translatedMapNames:"maps/names_trans.txt",originalActors:"other/Actors.txt",translatedActors:"other/Actors_trans.txt",originalArmors:"other/Armors.txt",translatedArmors:"other/Armors_trans.txt",originalClasses:"other/Classes.txt",translatedClasses:"other/Classes_trans.txt",originalCommonEvents:"other/CommonEvents.txt",translatedCommonEvents:"other/CommonEvents_trans.txt",originalEnemies:"other/Enemies.txt",translatedEnemies:"other/Enemies_trans.txt",originalItems:"other/Items.txt",translatedItems:"other/Items_trans.txt",originalSkills:"other/Skills.txt",translatedSkills:"other/Skills_trans.txt",originalSystem:"other/System.txt",translatedSystem:"other/System_trans.txt",originalTroops:"other/Troops.txt",translatedTroops:"other/Troops_trans.txt",originalWeapons:"other/Weapons.txt",translatedWeapons:"other/Weapons_trans.txt",originalPlugins:"plugins/plugins.txt",translatedPlugins:"plugins/plugins_trans.txt"},n=[{id:"maps-content",original:"originalMapText",translated:"translatedMapText"},{id:"maps-names-content",original:"originalMapNames",translated:"translatedMapNames"},{id:"actors-content",original:"originalActors",translated:"translatedActors"},{id:"armors-content",original:"originalArmors",translated:"translatedArmors"},{id:"classes-content",original:"originalClasses",translated:"translatedClasses"},{id:"common-events-content",original:"originalCommonEvents",translated:"translatedCommonEvents"},{id:"enemies-content",original:"originalEnemies",translated:"translatedEnemies"},{id:"items-content",original:"originalItems",translated:"translatedItems"},{id:"skills-content",original:"originalSkills",translated:"translatedSkills"},{id:"system-content",original:"originalSystem",translated:"translatedSystem"},{id:"troops-content",original:"originalTroops",translated:"translatedTroops"},{id:"weapons-content",original:"originalWeapons",translated:"translatedWeapons"},{id:"plugins-content",original:"originalPlugins",translated:"translatedPlugins"}],i=new Map;for(const[n,s]of Object.entries(t))i.set(n,readFileSync(join(e,s),"utf8").split("\n"));for(const e of n)z(e.id,i.get(e.original),i.get(e.translated))}(),window.scrollTo(0,0),requestAnimationFrame((()=>{for(const e of i.children){Y(e,"hidden","flex");let t=new Int32Array(e.children.length),n=0;for(const i of e.children){const{height:e}=i.getBoundingClientRect();t.set([e],n),n++}n=0;for(const i of e.children)i.style.height=`${t[n]+8}px`,i.firstElementChild.classList.add("hidden"),n++;n=null,t=null,e.style.height=`${e.scrollHeight}px`,Y(e,"hidden","flex"),requestAnimationFrame((()=>{document.body.classList.remove("invisible")}))}}));const D=new IntersectionObserver((e=>{for(const t of e)t.isIntersecting?t.target.firstElementChild.classList.remove("hidden"):t.target.firstElementChild.classList.add("hidden")}));function O(e){e=e.trim();try{if(e.startsWith("/")){const t=e.indexOf("/"),n=e.lastIndexOf("/"),i=e.slice(t+1,n),s=e.slice(n+1);return new RegExp(i,s)}const t={text:j?e:I?`\\b${e.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`:e.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&"),attr:j||_?"g":"gi"};return new RegExp(t.text,t.attr)}catch(t){return void alert(`Неверное регулярное выражение (${e.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&")}): ${t}`)}}function H(e,t){const n="TEXTAREA"===t.tagName?t.value.replaceAll("<","&lt;").replaceAll(">","&gt;"):t.innerHTML.replaceAll("<","&lt;").replaceAll(">","&gt;"),i=n.match(e)||[];if(0===i.length)return;const s=[];let r=0;for(const e of i){const t=n.indexOf(e,r),i=t+e.length,a=`<div class="inline">${n.slice(r,t)}</div>`,o=`<div class="inline bg-gray-500">${e}</div>`;s.push(a),s.push(o),r=i}const a=`<div class="inline">${n.slice(r)}</div>`;return s.push(a),s.join("")}function q(e){if(!(e=e.trim()))return;const t=new Map,n=$?[...document.getElementById(`${T}-content`).children]:[...i.children].flatMap((e=>[...e.children])),s=O(e);if(s){for(const e of n){const n=e.firstElementChild.children,i=H(s,n[2]);if(i&&t.set(n[2],i),t.size>15e3)return void alert("Совпадения превышают 15 000. Чтобы избежать утечку памяти, поиск был остановлен.");if(!C){const e=H(s,n[1]);if(e&&t.set(n[1],e),t.size>15e3)return void alert("Совпадения превышают 15 000. Чтобы избежать утечку памяти, поиск был остановлен.")}}return t}}function K(e=!0){e?"false"===o.getAttribute("moving")&&(Y(o,"translate-x-0","translate-x-full"),o.setAttribute("moving","true")):(o.classList.remove("translate-x-full"),o.classList.add("translate-x-0"),o.setAttribute("moving","true"));const t=document.getElementById("switch-search-content");function n(){if(Y(l,"hidden","flex"),Y(c,"hidden","flex"),"search"===t.innerHTML.trim()){t.innerHTML="menu_book";const n=JSON.parse(readFileSync(join(__dirname,"replacement-log.json"),"utf8")),i=new IntersectionObserver((e=>{for(const t of e)t.isIntersecting?t.target.firstElementChild.classList.remove("hidden"):t.target.firstElementChild.classList.add("hidden")}),{root:c,threshold:.1});for(const[s,r]of Object.entries(n)){const a=document.createElement("div"),o=document.createElement("div");o.classList.add("text-white","text-xl","cursor-pointer","bg-gray-700","my-1","p-1","border-2","border-gray-600"),o.innerHTML=`<div class="text-base text-gray-400">${s}</div><div class="text-base">${r.original}</div><div class="flex justify-center items-center text-xl text-white font-material">arrow_downward</div><div class="text-base">${r.translated}</div>`,a.appendChild(o),c.appendChild(a)}foundObserver.disconnect(),c.style.height=`${c.scrollHeight}px`;for(const d of c.children){const{width:m,height:u}=d.getBoundingClientRect();d.style.width=`${m}px`,d.style.height=`${u}px`,i.observe(d),d.firstElementChild.classList.add("hidden")}function e(e){const t=e.target.parentElement;if(t.hasAttribute("reverted"))return;if(!c.contains(t))return;const i=document.getElementById(t.firstElementChild.textContent);0===e.button?(P(i.parentElement.parentElement.parentElement.id.replace("-content",""),!1),requestAnimationFrame((()=>{requestAnimationFrame((()=>{i.parentElement.parentElement.scrollIntoView({block:"center",inline:"center"})}))}))):2===e.button&&(i.value=t.children[1].textContent,t.innerHTML=`<div class="inline text-base">Текст на позиции\n<code class="inline">${t.firstElementChild.textContent}</code>\nбыл возвращён к исходному значению\n<code class="inline">${t.children[1].textContent}</code></div>`,t.setAttribute("reverted",""),delete n[i.id],writeFileSync(join(__dirname,"replacement-log.json"),JSON.stringify(n,null,4),"utf8"))}c.addEventListener("mousedown",(t=>{e(t)}))}else t.innerHTML="search",c.innerHTML="",c.removeEventListener("mousedown",(t=>{e(t)}))}let i;if(l.children.length>0&&"no-results"!==l.firstElementChild.id&&(i=document.createElement("div"),i.classList.add("flex","justify-center","items-center","h-full","w-full"),i.innerHTML=o.classList.contains("translate-x-0")?'<div class="text-4xl animate-spin font-material">refresh</div>':"",l.appendChild(i)),"false"===o.getAttribute("shown"))o.addEventListener("transitionend",(()=>{i&&l.removeChild(i),t.addEventListener("click",n),o.setAttribute("shown","true"),o.setAttribute("moving","false")}),{once:!0});else{if(o.classList.contains("translate-x-full"))return o.setAttribute("shown","false"),o.setAttribute("moving","true"),t.removeEventListener("click",n),void o.addEventListener("transitionend",(()=>{o.setAttribute("moving","false")}),{once:!0});i&&l.removeChild(i),o.setAttribute("moving","false")}}function R(e=null,t=!0){if(!e)return void K(t);function n(e){const t=e.id.split("-");return[t[t.length-2],t[t.length-1]]}if(!(e=e.trim()))return;const i=q(e);if(!i||0===i.size)return l.innerHTML='<div id="no-results" class="flex justify-center items-center h-full">Нет совпадений</div>',void K(t);const s=new IntersectionObserver((e=>{for(const t of e)t.isIntersecting?t.target.firstElementChild.classList.remove("hidden"):t.target.firstElementChild.classList.add("hidden")}),{root:l,threshold:.1});for(const[e,t]of i){const i=document.createElement("div"),s=document.createElement("div");s.classList.add("text-white","text-xl","cursor-pointer","bg-gray-700","my-1","p-1","border-2","border-gray-600");const r=e.parentElement.parentElement.parentElement,[o,c]=(a=e.id).includes("original")?[document.getElementById(a.replace("original","translated")),1]:[document.getElementById(a.replace("translated","original")),0],[d,m]=n(e),[u,g]=n(o);s.innerHTML=`<div class="text-base">${t}</div><div class="text-xs text-gray-400">${e.parentElement.parentElement.id.slice(0,e.parentElement.parentElement.id.lastIndexOf("-"))} - ${d} - ${m}</div><div class="flex justify-center items-center text-xl text-white font-material">arrow_downward</div><div class="text-base">${"TEXTAREA"===o.tagName?o.value.replaceAll("<","&lt;").replaceAll(">","&gt;"):o.innerHTML.replaceAll("<","&lt;").replaceAll(">","&gt;")}</div><div class="text-xs text-gray-400">${o.parentElement.parentElement.id.slice(0,o.parentElement.parentElement.id.lastIndexOf("-"))} - ${u} - ${g}</div>`,s.setAttribute("data",`${r.id},${e.id},${c}`),i.appendChild(s),l.appendChild(i)}var a;s.disconnect(),l.style.height=`${l.scrollHeight}px`;for(const e of l.children){const{width:t,height:n}=e.getBoundingClientRect();e.style.width=`${t}px`,e.style.height=`${n}px`,s.observe(e),e.firstElementChild.classList.add("hidden")}function o(e){const t=e.target.parentElement.hasAttribute("data")?e.target.parentElement:e.target.parentElement.parentElement;if(!l.contains(t))return;const[n,i,s]=t.getAttribute("data").split(",");!function(e,t,n,i,s){if(0===e)P(t.id.replace("-content",""),!1),requestAnimationFrame((()=>{requestAnimationFrame((()=>{n.parentElement.parentElement.scrollIntoView({block:"center",inline:"center"})}))}));else if(2===e){if(n.id.includes("original"))return void alert("Оригинальные строки не могут быть заменены.");if(r.value.trim()){const e=N(n);if(e){const t=1===s?3:0;i.children[t].innerHTML=e}}}}(e.button,document.getElementById(n),document.getElementById(i),t,parseInt(s))}K(t),l.removeEventListener("mousedown",(e=>{o(e)})),l.addEventListener("mousedown",(e=>{o(e)}))}function N(e,t=!1){if(!t){const t=O(s.value),n=r.value,i=document.createElement("div");i.classList.add("inline","bg-red-600"),i.textContent=n;const a=e.value.split(t),o=a.flatMap(((e,t)=>[e,t<a.length-1?i:""])),l=a.join(n);L.set(e.id,{original:e.value,translated:l});const c={...JSON.parse(readFileSync(join(__dirname,"replacement-log.json"),"utf8")),...Object.fromEntries([...L])};return writeFileSync(join(__dirname,"replacement-log.json"),JSON.stringify(c,null,4),"utf8"),L.clear(),e.value=l,o.join("")}if(!(e=e.trim()))return;const n=q(e);if(!n||0===n.size)return;const i=O(e);if(!i)return;for(const e of n.keys())if(!e.id.includes("original")){const t=e.value.replace(i,r.value);L.set(e.id,{original:e.value,translated:t}),e.value=t}const a={...JSON.parse(readFileSync(join(__dirname,"replacement-log.json"),"utf8")),...Object.fromEntries([...L])};writeFileSync(join(__dirname,"replacement-log.json"),JSON.stringify(a,null,4),"utf8"),L.clear()}function W(n=!1){const s={"maps-content":"./maps/maps_trans.txt","maps-names-content":"./maps/names_trans.txt","actors-content":"./other/Actors_trans.txt","armors-content":"./other/Armors_trans.txt","classes-content":"./other/Classes_trans.txt","common-events-content":"./other/CommonEvents_trans.txt","enemies-content":"./other/Enemies_trans.txt","items-content":"./other/Items_trans.txt","skills-content":"./other/Skills_trans.txt","system-content":"./other/System_trans.txt","troops-content":"./other/Troops_trans.txt","weapons-content":"./other/Weapons_trans.txt","plugins-content":"./plugins/plugins_trans.txt"};d.classList.add("animate-spin"),requestAnimationFrame((()=>{let r=e;if(n){const e=new Date,n={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()};for(const[e,t]of Object.entries(n))n[e]=t.toString().padStart(2,"0");99===M&&(M=1);const i=`${Object.values(n).join("-")}_${M.toString().padStart(2,"0")}`;M++,r=join(t,i),ensureDirSync(r),ensureDirSync(join(r,"maps")),ensureDirSync(join(r,"other")),ensureDirSync(join(r,"plugins"))}for(const e of i.children){const t=[];for(const n of e.children){const e=n.firstElementChild.children[2];t.push(e.value.replaceAll("\n","\\n"))}const i=s[e.id];if(i){const e=join(r,i);writeFileSync(e,t.join("\n"),"utf8"),n||(F=!0)}}setTimeout((()=>{d.classList.remove("animate-spin")}),1e3)}))}function J(e){k&&setTimeout((()=>{k&&(W(!0),J(e))}),1e3*e)}function z(e,t,n){const s=document.createElement("div");s.id=e,s.classList.add("hidden","flex-col");for(const[i,r]of t.entries()){const t=document.createElement("div");t.id=`${e}-${i+1}`,t.classList.add("w-full","z-10");const a=document.createElement("div");a.classList.add("flex","flex-row");const o=document.createElement("div");o.id=`${e}-original-${i+1}`,o.textContent=r.replaceAll("\\n[","\\N[").replaceAll("\\n","\n"),o.classList.add(..."p-1 w-full h-auto bg-gray-800 outline outline-2 outline-gray-700 mr-2 inline-block whitespace-pre-wrap".split(" "));const l=document.createElement("textarea"),c=n[i].split("\\n");l.id=`${e}-translated-${i+1}`,l.rows=c.length,l.value=c.join("\n"),l.classList.add(..."p-1 w-full h-auto bg-gray-800 resize-none outline outline-2 outline-gray-700 focus:outline-gray-400".split(" "));const d=document.createElement("div");d.id=`${e}-row-${i+1}`,d.textContent=i+1,d.classList.add(..."p-1 w-36 h-auto bg-gray-800 outline-none".split(" ")),a.appendChild(d),a.appendChild(o),a.appendChild(l),t.appendChild(a),s.appendChild(t)}i.appendChild(s)}function P(e,t=!0){if(T!==e)if("main"===e){T="main",document.getElementById("current-state").innerHTML="",pageLoadedDisplay.innerHTML="check_indeterminate_small",D.disconnect();for(const e of i.children)for(const t of e.children)t.firstElementChild.classList.add("hidden")}else B=T,T=e,function(e,t,n=!0){const i=document.getElementById("current-state"),s=document.getElementById("is-loaded");requestAnimationFrame((()=>{s.innerHTML="refresh",s.classList.toggle("animate-spin"),i.innerHTML=e,requestAnimationFrame((()=>{const e=document.getElementById(t);e.classList.remove("hidden"),e.classList.add("flex","flex-col"),"main"!==B&&(Y(document.getElementById(`${B}-content`),"flex","hidden"),D.disconnect());for(const t of e.children)D.observe(t);n&&Y(a,"-translate-x-full","translate-x-0"),s.innerHTML="done",s.classList.toggle("animate-spin")}))}))}(e,`${e}-content`,t)}function V(e){const t=document.activeElement;if(!t||!t.id||"alt"!==e&&"ctrl"!==e)return;const n=t.id.split("-"),i=parseInt(n.pop(),10),s=n.join("-");if(isNaN(i))return;const r="alt"===e?1:-1,a=`${s}-${i+r}`,o=document.getElementById(a);if(!o)return;const l=o.clientHeight+8;window.scrollBy(0,r*l),t.blur(),o.focus(),o.setSelectionRange(0,0)}function U(e){switch(e.code){case"Escape":document.activeElement.blur();break;case"Enter":e.altKey?V("alt"):e.ctrlKey&&V("ctrl");break;case"KeyS":e.ctrlKey&&W();break;case"KeyF":e.ctrlKey&&s.focus();break;case"KeyC":document.activeElement!==s&&e.altKey&&X();break;case"KeyG":e.ctrlKey&&"main"!==T&&(b.classList.contains("hidden")?function(){b.classList.remove("hidden"),b.focus();const e=document.getElementById(`${T}-content`).lastElementChild.id.split("-").at(-1);b.placeholder=`Перейти к строке... от 1 до ${e}`,b.addEventListener("keydown",(function e(t){if("Enter"===t.code){const t=b.value,n=document.getElementById(`${T}-content-${t}`);n&&n.scrollIntoView({block:"center",inline:"center"}),b.value="",b.classList.add("hidden"),b.removeEventListener("keydown",e)}"Escape"===t.code&&(b.value="",b.classList.add("hidden"),b.removeEventListener("keydown",e))}))}():b.classList.add("hidden"))}}function X(){m.classList.add("animate-spin");const e=fork(join(__dirname,"../resources/write.js"),[],{timeout:15e3});e.on("error",(t=>{m.classList.remove("animate-spin"),alert(`Не удалось записать файлы: ${t}`),e.kill()})),e.on("close",(()=>{m.classList.remove("animate-spin"),alert("Все файлы записаны успешно.")}))}function Y(e,t,n){const i=e.classList.contains(n);e.classList.toggle(t,i),e.classList.toggle(n,!i)}function G(){j||(_=!_,u.classList.toggle("bg-gray-500"))}function Q(){j||(I=!I,g.classList.toggle("bg-gray-500"))}function Z(){j=!j,j&&(_=!1,u.classList.remove("bg-gray-500"),I=!1,g.classList.remove("bg-gray-500")),p.classList.toggle("bg-gray-500")}function ee(){C=!C,f.classList.toggle("bg-gray-500")}function te(){$=!$,h.classList.toggle("bg-gray-500")}ipcRenderer.on("exit-sequence",(()=>{F?ipcRenderer.send("quit"):ipcRenderer.invoke("quit-confirm").then((e=>e?(W(),void setTimeout((()=>{ipcRenderer.send("quit")}),1e3)):void 0))})),document.addEventListener("keydown",(e=>{document.activeElement===document.body&&function(e){switch(e.code){case"Escape":P("main",!1);break;case"Tab":Y(a,"translate-x-0","-translate-x-full");break;case"KeyR":R();break;case"Digit1":P("maps",!1);break;case"Digit2":P("maps-names",!1);break;case"Digit3":P("actors",!1);break;case"Digit4":P("armors",!1);break;case"Digit5":P("classes",!1);break;case"Digit6":P("common-events",!1);break;case"Digit7":P("enemies",!1);break;case"Digit8":P("items",!1);break;case"Digit9":P("skills",!1);break;case"Digit0":P("system",!1);break;case"Minus":P("troops",!1);break;case"Equal":P("weapons",!1)}}(e),U(e)})),s.addEventListener("keydown",(e=>function(e){if("Enter"===e.code&&(e.preventDefault(),e.ctrlKey?s.value+="\n":s.value.trim()?(l.innerHTML="",R(s.value,!1)):l.innerHTML='<div class="flex justify-center items-center h-full">Результатов нет</div>'),e.altKey)switch(e.code){case"KeyC":G();break;case"KeyW":Q();break;case"KeyR":Z();break;case"KeyT":ee();break;case"KeyL":te()}}(e))),a.addEventListener("click",(e=>P(e.target.id))),document.getElementById("menu-button").addEventListener("click",(function(){Y(a,"translate-x-0","-translate-x-full")})),document.getElementById("search-button").addEventListener("click",(function(){s.value?(l.innerHTML="",R(s.value,!1)):document.activeElement===document.body&&s.focus()})),document.getElementById("replace-button").addEventListener("click",(function(){s.value&&r.value&&N(s.value,!1)})),u.addEventListener("click",G),g.addEventListener("click",Q),p.addEventListener("click",Z),f.addEventListener("click",ee),h.addEventListener("click",te),d.addEventListener("click",W),m.addEventListener("click",X),document.getElementById("options-button").addEventListener("click",(function(){function e(){k=!k,k?(y.classList.remove("hidden"),J(S)):y.classList.add("hidden"),v.innerHTML="close"}function t(){S=parseInt(E.value),E.value=S<60?60:S>3600?3600:S}function n(){w=parseInt(x.value),x.value=w<1?1:w>100?100:w}if(A=!A,document.getElementById("options-menu").classList.toggle("hidden"),A)document.body.classList.add("overflow-hidden"),v.addEventListener("click",e),E.addEventListener("change",t),x.addEventListener("change",n);else{document.body.classList.remove("overflow-hidden"),v.removeEventListener("click",e),E.removeEventListener("change",t),x.removeEventListener("change",n);const i={backup:{enabled:k,period:S,max:w}};writeFileSync(join(__dirname,"settings.json"),JSON.stringify(i,null,4),"utf8")}})),document.addEventListener("keydown",(e=>function(e){switch(e.key){case"Tab":case e.altKey:e.preventDefault();break;case"F4":if(!e.altKey)return;if(e.preventDefault(),F)return void ipcRenderer.send("quit");ipcRenderer.invoke("quit-confirm").then((e=>e?(W(),void setTimeout((()=>{ipcRenderer.send("quit")}),1e3)):void 0));break;case"F5":e.preventDefault(),document.body.classList.add("hidden"),requestAnimationFrame((()=>{location.reload()}));break;default:F&&document.activeElement!==document.body&&document.activeElement!==s&&document.activeElement!==r&&(F=!1)}}(e)));const ne=[];let ie=null;document.addEventListener("focus",(function(e){const t=e.target;for(const e of ne)e.remove();t!==ie&&(ie=t,function(e){const t=function(e){const t=[],n=e.value.split("\n"),i=parseFloat(window.getComputedStyle(e).lineHeight),s=e.getBoundingClientRect(),r=s.y+window.scrollY,a=s.x,o=document.createElement("canvas").getContext("2d");o.font='18px "Segoe UI"';let l=r;for(let e=0;e<n.length-1;e++){const s=n[e],r=a+o.measureText(`${s} `).width;t.push({left:r,top:l}),l+=i}return t}(e);if(0!==t.length)for(const e of t){const{left:t,top:n}=e,i=document.createElement("div");i.classList.add("text-gray-400","absolute","font-lg","z-50","select-none","cursor-default"),i.textContent="\\n",i.style.left=`${t}px`,i.style.top=`${n}px`,ne.push(i),document.body.appendChild(i)}}(t))}),!0),document.addEventListener("blur",(function(e){const t=e.target;for(const e of ne)e.remove();t===ie&&(ie=null)}),!0)}document.addEventListener("DOMContentLoaded",render);